{% include 'snippets/signin_header.html'%}

<body class="text-center">
    <div class="form-signin">
        <!-- <img class="mb-4" src="/docs/4.4/assets/brand/bootstrap-solid.svg" alt="" width="72" height="72"> -->
        <h1 class="h3 mb-3 font-weight-normal">내 정보 관리</h1> {% if alert_success %}
        <div class="alert alert-success" role="alert">
            {{alert_success}}
        </div>
        {% endif %} {% if alert_fail %}
        <div class="alert alert-danger" role="alert">
            {{alert_fail}}
        </div>
        {% endif %} {% if not no_form %}
        <div class="input-group input-group-sm">
            <div class="input-group-prepend">
                <span class="input-group-text">ID</span>
            </div>
            <input type="text" class="form-control" value="{{uid}}" aria-label="User ID" aria-describedby="basic-addon1" id="UID" readonly>
        </div>

        <div class="btn-group btn-group-toggle mb-3" data-toggle="buttons" id="selGroup" style="width:100%;">
            <select class="custom-select" id="grade">
                <option value="1학년">1</option>
                <option value="2학년">2</option>
                <option value="3학년">3</option>
            </select>
            <div class="input-group-append">
                <label class="input-group-text" for="btnGroup">학년</label>
            </div>
            <select class="custom-select" id="class">
                {% for class in classes %}
                <option value="{{class}}반">{{class}}</option>
                {% endfor %}
            </select>
            <div class="input-group-append">
                <label class="input-group-text" for="btnGroup">반</label>
            </div>
        </div>

        <div class="g-recaptcha mb-3" data-sitekey="6LdQV8wUAAAAAI-hdFDZpLlxV7Cm7SO1H-YluqkL" data-callback="activate" data-expired-callback="disactivate"></div>

        <button class="btn btn-lg btn-primary btn-block" type="button" id="submit" disabled>저장</button>
        <button class="btn btn-block" type="button" id="delete" disabled>내 정보 삭제(탈퇴)</button>

        <p class="mt-5 mb-3 text-muted">&copy; 2019 서현교</p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
    <script>
        function post_to_url(path, params, method) {
            method = method || "post"; // Set method to post by default, if not specified.
            // The rest of this code assumes you are not using a library.
            // It can be made less wordy if you use one.
            var form = document.createElement("form");
            form.setAttribute("method", method);
            form.setAttribute("action", path);
            for (var key in params) {
                var hiddenField = document.createElement("input");
                hiddenField.setAttribute("type", "hidden");
                hiddenField.setAttribute("name", key);
                hiddenField.setAttribute("value", params[key]);
                form.appendChild(hiddenField);
            }
            document.body.appendChild(form);
            form.submit();
        }

        function activate(recaptcha_token) {
            document.getElementById('submit').disabled = false;
            document.getElementById('delete').disabled = false;
            document.getElementById("submit").onclick = null;
            document.getElementById("submit").onclick = function() {
                var userGrade = $("#grade option:selected").text();
                var userClass = $("#class option:selected").text();
                post_to_url("/user/settings/", {
                    'method': 'update',
                    'token': '{{token}}',
                    'grade': userGrade,
                    'class': userClass,
                    'recaptcha': recaptcha_token
                })
            };
            document.getElementById("delete").onclick = function() {
                var userGrade = $("#grade option:selected").text();
                var userClass = $("#class option:selected").text();
                post_to_url("/user/settings/", {
                    'method': 'delete',
                    'token': '{{token}}',
                    'grade': userGrade,
                    'class': userClass,
                    'recaptcha': recaptcha_token
                })
            };
        };

        function disactivate() {
            document.getElementById('submit').disabled = true;
            document.getElementById('delete').disabled = true;
            return false;
        };
        {% if current_grade %}
        $("#grade").val("{{current_grade}}학년").prop("selected", true);
        {% endif %}
        {% if current_grade %}
        $("#class").val("{{current_class}}반").prop("selected", true);
        {% endif %}
    </script>
    <script src="https://www.google.com/recaptcha/api.js?hl=ko" async defer></script>
    {% endif %}
</body>

</html>
